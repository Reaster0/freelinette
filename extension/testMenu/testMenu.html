<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
	<link rel="stylesheet" href="testMenu.css"/>
</head>

<body>
	<div id="glassMenu" class="glass">
		<div class="menuBackground">
			<div id="testInterface">
				<div id="newTestInput" class="newTestInput">
					<div id="data-dropdown" class="dropDown">
						<button id="action-dropdown-button" class="btnActionFull">Action</button>
						<div class="dropDownMenu">
							<button id="btnActionClick" class="btnActionEmptyAlt">Click</butt>
							<button id="btnActionFill" class="btnActionEmptyAlt">Fill</butt>
							<button id="btnActionObserve" class="btnActionEmptyAlt">Look</button>
						</div>
					</div>
					<button class="btnActionEmpty">Element</button>
					<button class="btnActionEmptyAlt">Params</button>
				</div>
				<button id="btnConfirmTest" class="btnActionFullAlt">+</button>
				<div id="testList"></div>
			</div>
		</div>
	</div>
</body>

<script>
	let _testInput = {
		"action": null,
		"element": null,
		"params": {
			"name": null,
			"value": null}
	}

	let testsQueue = []

	//menu to create tests
	let testInput = new Proxy(_testInput, {
		set: function (target, key, value) {
			console.log("has changed")
			if (key === "action"){
				if (value === null)
					document.getElementById("action-dropdown-button").innerHTML = "Action"
				else
					document.getElementById("action-dropdown-button").innerHTML = value
				}
			// if (key === "params") {
			// 	if (value.name === null)
			// 		document.getElementById("data-dropdown-button").innerHTML = "Params"
			// 	else
			// 		document.getElementById("data-dropdown-button").innerHTML = value.name
			// }
			target[key] = value
		}
	})

	drawerSystemInit()
	testConfigInput()

	//append a new test in the dom
	function newTestAppend(parentNode, test, id){
		const testElement = document.createElement("div")
		testElement.className = "newTestInput"
		testElement.attributes.number = id

		const actionBtn = document.createElement("button")
		actionBtn.className = "btnActionFull deButtoned"
		if (test.action != null)
			actionBtn.innerHTML = test.action
		else
			actionBtn.innerHTML = "Action"

		const elementBtn = document.createElement("button")
		elementBtn.className = "btnActionEmpty deButtoned"
		if (test.element != null)
			elementBtn.innerHTML = test.element
		else
			elementBtn.innerHTML = "Element"

		const paramsBtn = document.createElement("button")
		paramsBtn.className = "btnActionEmptyAlt deButtoned"
		//todo
		paramsBtn.innerHTML = "Params"

		const deleteBtn = document.createElement("button")
		deleteBtn.className = "buttonDelete"
		deleteBtn.innerHTML = "X"
		deleteBtn.onclick = function(){
			testsQueue.splice(testElement.attributes.number, 1)
			parentNode.innerHTML = ""
			for (let key in testsQueue)
				newTestAppend(parentNode, testsQueue[key], key)
		}

		testElement.appendChild(actionBtn)
		testElement.appendChild(elementBtn)
		testElement.appendChild(paramsBtn)
		testElement.appendChild(deleteBtn)
		parentNode.appendChild(testElement)

	}

	//system for the buttons for creation of the tests (related to #newTestInput)
	function testConfigInput() {
		document.getElementById("btnConfirmTest").addEventListener("click", (e) => {
			testsQueue.push(structuredClone(_testInput))
			newTestAppend(document.getElementById("testList"), structuredClone(_testInput), testsQueue.length - 1)
			testInput.action = null
			testInput.element = null
			testInput.params = {}
		})
		document.getElementById("btnActionClick").addEventListener("click", (e) => {
			testInput.action = "Click"
		})
		document.getElementById("btnActionFill").addEventListener("click", (e) => {
			testInput.action = "Fill"
		})
		document.getElementById("btnActionObserve").addEventListener("click", (e) => {
			testInput.action = "Look"
		})
	}

	//initialize the animation of the drawer with id #data-dropdown
	function drawerSystemInit() {
		document.addEventListener('click', e => {
			const isDropdownButton = e.target.matches('#action-dropdown-button')
			if (!isDropdownButton && e.target.closest("#data-dropdown") != null && !e.target.matches("button"))
				return
			
			let currentDropdown
			if (isDropdownButton) {
				currentDropdown = e.target.closest('#data-dropdown')
				currentDropdown.classList.toggle('active')
			}
			
			document.querySelectorAll("#data-dropdown.active").forEach(dropdown => {
				if (dropdown !== currentDropdown)
				dropdown.classList.remove('active')
			})
		})
	}
</script>

</html>