<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
	<link rel="stylesheet" href="testMenu.css"/>
</head>

<body>
	<div id="glassMenu" class="glass">
		<div class="menuBackground">
			<div class="listTests">
				<div id="newTestInput" class="newTestInput">
					<div id="data-dropdown" class="dropDown">
						<button id="data-dropdown-button" class="btnActionFull">Action</button>
						<div class="dropDownMenu">
							<button id="btnActionClick" class="btnActionEmptyAlt">Click</butt>
							<button id="btnActionFill" class="btnActionEmptyAlt">Fill</butt>
							<button id="btnActionObserve" class="btnActionEmptyAlt">Look</button>
						</div>
					</div>
					<button class="btnActionEmpty">Element</button>
					<button class="btnActionEmptyAlt">Params</button>
				</div>
				<button id="btnConfirmTest" class="btnActionFullAlt">Confirm</button>
			</div>
		</div>
	</div>	
</body>

<script>
	let _testInput = {
		"action": null,
		"element": null,
		"params": {}
	}

	let _testsQueue = []

	let testInput = new Proxy(_testInput, {
		set: function (target, key, value) {
			console.log("has changed")
			if (key === "action"){
				if (value === null)
					document.getElementById("data-dropdown-button").innerHTML = "Action"
				else
					document.getElementById("data-dropdown-button").innerHTML = value
			}
			target[key] = value
		}
	})

	let testsQueue = new Proxy(_testsQueue, {
		set: function (target, key, value) {
			if (key == "length")
				return true
			console.log("testqueue has changed", key, value)
			target.push(value)
			return true
		}
	})

	drawerSystemInit()
	inputingForm()
	testConfigInput()

	

	function testConfigInput() {
		document.getElementById("btnConfirmTest").addEventListener("click", (e) => {
			console.log(_testInput)
			testsQueue.push(structuredClone(_testInput))
			testInput.action = null
			testInput.element = null
			testInput.params = {}
			console.log(_testsQueue)
		})
		document.getElementById("btnActionClick").addEventListener("click", (e) => {
			testInput.action = "Click"
		})
		document.getElementById("btnActionFill").addEventListener("click", (e) => {
			testInput.action = "Fill"
		})
		document.getElementById("btnActionObserve").addEventListener("click", (e) => {
			testInput.action = "Look"
		})
	}

	function drawerSystemInit() {
		document.addEventListener('click', e => {
			const isDropdownButton = e.target.matches('#data-dropdown-button')
			if (!isDropdownButton && e.target.closest("#data-dropdown") != null && !e.target.matches("button"))
				return
			
			let currentDropdown
			if (isDropdownButton) {
				currentDropdown = e.target.closest('#data-dropdown')
				currentDropdown.classList.toggle('active')
			}
			
			document.querySelectorAll("#data-dropdown.active").forEach(dropdown => {
				if (dropdown !== currentDropdown)
				dropdown.classList.remove('active')
			})
		})
	}

	function inputingForm() {
		const inputForm = document.getElementById('testInput')
		document.getElementById('newTestInput').onsubmit = function(e) {
			e.preventDefault();
			const newTest = document.createElement('div');
			newTest.className = 'test';

			const infoTest = document.createElement('input');
			infoTest.className = 'text';
			infoTest.value = inputForm.value

			const deleteBtn = document.createElement('button');
			deleteBtn.className = 'buttonDelete';
			deleteBtn.innerHTML = 'Delete';
			deleteBtn.addEventListener('click', function(e) {
				console.log('deleteBtn clicked');
				document.getElementsByClassName('listTests')[0].removeChild(newTest)
			})

			document.getElementsByClassName('listTests')[0].appendChild(newTest);
			newTest.appendChild(infoTest)
			newTest.appendChild(deleteBtn)
			inputForm.value = ''
		}
	}
</script>

</html>